<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Display Webcam Stream with Person Detection</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>

<body>

<style>
  #container {
    margin: 0px auto;
    width: 375px;
    height: 700px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    position: relative;
  }

  #videoElement {
    height: 700px;
    background-color: #666;
    transform: scaleX(-1);
  }

  #log {
    margin-top: 20px;
    text-align: center;
    font-family: Arial, sans-serif;
    font-size: 18px;
  }

  #overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    font-family: Arial, sans-serif;
    font-size: 24px;
    display: none; /* Anfangs ausgeblendet */
  }
</style>

<div id="container">
  <video autoplay="true" id="videoElement"></video>
  <div id="overlay">Hier bist du</div>
</div>
<div id="log">Initializing...</div>

<script>
  const video = document.querySelector("#videoElement");
  const log = document.getElementById("log");
  const overlay = document.getElementById("overlay");

  // Zugriff auf die Webcam
  if (navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(function (stream) {
        video.srcObject = stream;
      })
      .catch(function (err0r) {
        console.log("Something went wrong!");
        log.textContent = "Unable to access webcam.";
      });
  }

  // TensorFlow.js COCO-SSD Modell laden
  let model;
  let timeoutId; // Timeout f체r das Einblenden des Overlays
  cocoSsd.load().then(loadedModel => {
    model = loadedModel;
    log.textContent = "Model loaded. Detecting...";
    analyzeFrame(); // Starte die Analyse
  });

  // Analyse der Videoframes
  function analyzeFrame() {
    if (video.readyState === video.HAVE_ENOUGH_DATA && model) {
      model.detect(video).then(predictions => {
        const personDetected = predictions.some(p => p.class === 'person');
        if (personDetected) {
          log.textContent = "Person detected!";
          if (!timeoutId) { // Sicherstellen, dass der Timeout nur einmal gesetzt wird
            timeoutId = setTimeout(() => {
              overlay.style.display = "block"; // Overlay sichtbar machen
            }, 2000);
          }
        } else {
          log.textContent = "No person detected.";
          overlay.style.display = "none"; // Overlay ausblenden, falls keine Person
          clearTimeout(timeoutId); // Timeout zur체cksetzen
          timeoutId = null;
        }
      });
    }
    requestAnimationFrame(analyzeFrame); // Wiederhole die Analyse f체r den n채chsten Frame
  }
</script>

</body>
</html>